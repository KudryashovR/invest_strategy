{% extends 'strategy/base.html' %}
{% block title %}Контролируемые акции - Check Div{% endblock %}
{% load custom_filters %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">Контролируемые акции</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <div class="btn-group me-2">
            <form action="{% url 'add_asset' %}" method="GET">
                <button class="btn btn-sm btn-outline-primary">
                    <i class="bi bi-bag-plus"></i> Добавить акцию
            </form>
        </div>
    </div>
</div>
<div class="row">
    <div class="table-responsive">
        <table class="table table-striped table-hover text-center">
            <thead>
            <tr>
                <td>Тикер</td>
                <td>Цена покупки</td>
                <td>Количество</td>
                <td>Дата покупки</td>
                <td>Время владения (мес)</td>
                <td>Текущая цена</td>
                <td>Разница</td>
                <td>Ожидаемая цена (по ключевой)</td>
                <td>Оценка</td>
                <td>Ожидаемая цена (аналитика)</td>
                <td>Состояние</td>
                <td></td>
            </tr>
            </thead>
            <tbody>
            {% for ticker, data in assets.items %}
            <tr class="align-middle">
                <td><img class="rounded-circle" src="{{ data.0 }}" width="32px" height="auto"><br>{{ ticker|remove_after_last_underscore }}</td>
                <td class="bg-warning">
                    <div class="editable-field" data-id="{{ data.11 }}" data-field="check_asset:buy_price">
                        <span class="display-value dotted-underline" style="cursor: pointer;">{{ data.1 }}</span>
                        <div class="edit-form" style="display: none;">
                            <input type="text" class="edit-input" value="{{ data.1 }}">
                            <button class="btn btn-sm btn-success save-btn">
                                <i class="bi bi-check"></i>
                            </button>
                            <button class="btn btn-sm btn-secondary cancel-btn">
                                <i class="bi bi-x"></i>
                            </button>
                        </div>
                    </div>
                </td>
                <td class="bg-warning">
                    <div class="editable-field" data-id="{{ data.11 }}" data-field="check_asset:buy_count">
                        <span class="display-value dotted-underline" style="cursor: pointer;">{{ data.2 }}</span>
                        <div class="edit-form" style="display: none;">
                            <input type="text" class="edit-input" value="{{ data.2 }}">
                            <button class="btn btn-sm btn-success save-btn">
                                <i class="bi bi-check"></i>
                            </button>
                            <button class="btn btn-sm btn-secondary cancel-btn">
                                <i class="bi bi-x"></i>
                            </button>
                        </div>
                    </div>
                </td>
                <td class="bg-warning">
                    <div class="editable-field" data-id="{{ data.11 }}" data-field="check_asset:buy_date">
                        <span class="display-value dotted-underline" style="cursor: pointer;">{{ data.3|date:"j.m.Y" }}</span>
                        <div class="edit-form" style="display: none;">
                            <input type="text" class="edit-input" value='{{ data.3|date:"j.m.Y" }}'>
                            <button class="btn btn-sm btn-success save-btn">
                                <i class="bi bi-check"></i>
                            </button>
                            <button class="btn btn-sm btn-secondary cancel-btn">
                                <i class="bi bi-x"></i>
                            </button>
                        </div>
                    </div>
                </td>
                <td>{{ data.4 }}</td>
                <td>{{ data.5 }}</td>
                {% if data.6 < 0 %}
                <td class="bg-danger">{{ data.6|floatformat:2 }}</td>
                {% else %}
                <td class="bg-success">{{ data.6|floatformat:2 }}</td>
                {% endif %}
                <td>{{ data.7|floatformat:2 }}</td>
                {% if data.8 %}
                <td class="bg-danger">Can sold</td>
                {% else %}
                <td class="bg-success">Wait</td>
                {% endif %}
                <td class="bg-warning">
                    <div class="editable-field" data-id="{{ data.11 }}" data-field="check_asset:excepted_price">
                        <span class="display-value dotted-underline" style="cursor: pointer;">{{ data.9 }}</span>
                        <div class="edit-form" style="display: none;">
                            <input type="text" class="edit-input" value="{{ data.9 }}">
                            <button class="btn btn-sm btn-success save-btn">
                                <i class="bi bi-check"></i>
                            </button>
                            <button class="btn btn-sm btn-secondary cancel-btn">
                                <i class="bi bi-x"></i>
                            </button>
                        </div>
                    </div>
                </td>
                {% if data.10 %}
                <td class="bg-danger">DANGER!!!</td>
                {% else %}
                <td class="bg-success">OK</td>
                {% endif %}
                <td>
                    <form action="{% url 'delete_asset' data.11 %}" method="GET">
                        <button type="submit" class="btn btn-danger">
                            <i class="bi bi-trash"></i> Удалить
                        </button>
                    </form>
                </td>
            </tr>
            {% endfor %}
            <tr>
                <td class="text-center fw-bold" colspan="11">
                    ИТОГО: {{ total_assets }} активов на сумму {{ total_price|floatformat:2 }} (Профит/лос: {{ total_p_f|floatformat:2 }} за период {{ total_owner_period }} мес.)
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>
<script>
    setTimeout(function() {
    location.reload();
}, 30000);
</script>
{% endblock %}